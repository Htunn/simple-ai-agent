# Alertmanager configuration for Simple AI Agent AIOps
global:
  # How long to wait before re-sending a previously resolved alert
  resolve_timeout: 5m
  # SMTP (optional — configure if you want email alerts)
  # smtp_smarthost: 'smtp.example.com:587'
  # smtp_from: 'alertmanager@example.com'
  # smtp_auth_username: 'alertmanager'
  # smtp_auth_password: 'password'

# ── Templates ───────────────────────────────────────────────────────────────
# templates:
#   - '/etc/alertmanager/templates/*.tmpl'

# ── Routing ─────────────────────────────────────────────────────────────────
route:
  # Default receiver
  receiver: simple-ai-agent-webhook
  # Group alerts by alertname + namespace combo
  group_by: ['alertname', 'namespace', 'severity']
  # Wait this long before sending a new group of alerts
  group_wait: 30s
  # How long to wait before repeating an alert
  group_interval: 5m
  repeat_interval: 4h

  routes:
    # Critical alerts — send immediately with shorter repeat
    - match:
        severity: critical
      receiver: simple-ai-agent-webhook
      group_wait: 10s
      repeat_interval: 1h
      continue: false

    # Warning alerts — use default timing
    - match:
        severity: warning
      receiver: simple-ai-agent-webhook
      repeat_interval: 6h

# ── Inhibit rules ───────────────────────────────────────────────────────────
inhibit_rules:
  # Suppress warning if a critical alert is already firing for the same resource
  - source_match:
      severity: critical
    target_match:
      severity: warning
    equal: ['alertname', 'namespace']

# ── Receivers ───────────────────────────────────────────────────────────────
receivers:
  - name: simple-ai-agent-webhook
    webhook_configs:
      - url: "http://app:8000/api/webhook/alertmanager"
        # Optional HMAC secret — must match ALERTMANAGER_WEBHOOK_SECRET env var
        # http_config:
        #   basic_auth:
        #     username: ''
        #     password: ''
        send_resolved: true
        # Maximum number of alerts to include per notification
        max_alerts: 20
