# Prometheus configuration for Simple AI Agent AIOps stack
global:
  scrape_interval: 15s
  evaluation_interval: 15s
  scrape_timeout: 10s
  external_labels:
    environment: production
    service: simple-ai-agent

# Load alert rules
rule_files:
  - /etc/prometheus/alert_rules.yml

# Alertmanager integration
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - alertmanager:9093
      timeout: 10s

# Scrape configurations
scrape_configs:
  # ── Application ────────────────────────────────────────────────
  - job_name: simple-ai-agent
    scrape_interval: 15s
    static_configs:
      - targets:
          - app:8000
    metrics_path: /metrics
    honor_labels: true

  # ── Prometheus self-monitoring ──────────────────────────────────
  - job_name: prometheus
    static_configs:
      - targets:
          - localhost:9090

  # ── Alertmanager ───────────────────────────────────────────────
  - job_name: alertmanager
    static_configs:
      - targets:
          - alertmanager:9093

  # ── PostgreSQL (via postgres_exporter) ─────────────────────────
  # Uncomment if you add postgres_exporter to docker-compose.yml
  # - job_name: postgres
  #   static_configs:
  #     - targets:
  #         - postgres-exporter:9187

  # ── Redis (via redis_exporter) ─────────────────────────────────
  # Uncomment if you add redis_exporter to docker-compose.yml
  # - job_name: redis
  #   static_configs:
  #     - targets:
  #         - redis-exporter:9121

  # ── Kubernetes API server (if in-cluster) ──────────────────────
  # Uncomment and configure kubeconfig for cluster metrics
  # - job_name: kubernetes-apiservers
  #   kubernetes_sd_configs:
  #     - role: endpoints
  #   scheme: https
  #   tls_config:
  #     ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
  #   bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
  #   relabel_configs:
  #     - source_labels: [__meta_kubernetes_namespace, __meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]
  #       action: keep
  #       regex: default;kubernetes;https
